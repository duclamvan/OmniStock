The "PENDING-..." ID is appearing because **your code is generating a placeholder** when it fails to get the real number from PPL.

The root cause of the failure is a **wrong endpoint call**. You are trying to send a `Batch ID` (UUID for a group of orders) to an endpoint that expects a single `Shipment ID` or `Tracking Number`.

### The Fix: Switch endpoints & Add a Wait Loop

You cannot get the tracking number immediately after creating a batch. You must **poll** the batch status endpoint until PPL finishes processing.

Here is the logic you need to implement in Replit to fix this:

#### 1. Change the URL

* ‚ùå **Don't use:** `GET /shipment/{id}` (This crashes with 500 when you send a Batch ID).
* ‚úÖ **Use:** `GET /shipment/batch/{batchId}` (This is made for the ID you have).

#### 2. Implement the "Retry Loop" (Polling)

PPL needs about 1‚Äì3 seconds to generate the numbers. If you ask immediately, the array is empty.

**Copy this Python function to your Replit backend:**

```python
import time

def get_tracking_numbers_from_batch(token, batch_id):
    # ‚úÖ CORRECT ENDPOINT for Batch IDs
    url = f"{BASE_URL}/shipment/batch/{batch_id}"
    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    # Try 5 times (wait 2 seconds between attempts)
    for attempt in range(5):
        print(f"üì° Attempt {attempt+1}: Checking Batch {batch_id}...")
        
        response = requests.get(url, headers=headers)
        
        if response.status_code == 200:
            data = response.json()
            
            # Check if processing is done
            # (Adjust 'status' check based on exact API response, e.g., 'PROCESSED' or 'COMPLETED')
            # But usually, we just look if 'packages' exist and have numbers.
            
            found_numbers = []
            
            # Navigate the JSON structure carefully
            # Usually: items -> [order] -> packages -> [package] -> parcelNumber
            items = data.get('items', []) or data.get('shipments', [])
            
            for item in items:
                # In some versions, 'packages' is direct, in others it's inside an object
                packages = item.get('packages', [])
                for pkg in packages:
                    t_num = pkg.get('parcelNumber')
                    if t_num:
                        found_numbers.append(t_num)
            
            if found_numbers:
                print(f"‚úÖ Found Tracking Numbers: {found_numbers}")
                return found_numbers[0] # Return the first one (or map them to orders)
            
        else:
            print(f"‚ö†Ô∏è API Error: {response.status_code}")

        # Wait 2 seconds before trying again
        time.sleep(2)

    print("‚ùå Timed out waiting for PPL to generate numbers.")
    return None

```

### Why you see "PENDING-..."

The string `PENDING-ab02c706-1` is **not** coming from PPL. It is being generated by **your own code** (probably inside your `create_label` function).

Look for a line in your code that looks like this:

```python
# FAKE CODE EXAMPLE
tracking_number = api_result or f"PENDING-{batch_id}-1"

```

Your code is saying: *"I tried to get the number, failed, so I'll save this fake 'PENDING' ID so the database doesn't crash."*

**Solution:**

1. Apply the Polling code above.
2. If it returns `None` (failure), **do not save** the "PENDING" string as the `tracking_number`. Leave it `null` or empty so you know to try again later.